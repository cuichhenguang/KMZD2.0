<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="copyright" content="www.apicloud.com" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>孔孟之道--单曲评论详情</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
        html,
        body {
            min-height: 100%;
            background: #ebebeb;
        }

        .fr {
            float: right;
        }

        .fl {
            float: left;
        }

        .clear {
            clear: both;
        }

        .mt5 {
            margin-top: 5px;
        }

        .mt10 {
            margin-top: 10px;
        }

        .mt15 {
            margin-top: 15px;
        }

        .mt20 {
            margin-top: 20px;
        }

        .ml5 {
            margin-left: 0.5em;
        }

        .mr5 {
            margin-right: 0.5em;
        }

        .hdivider {
            width: 100%;
            height: 1px;
            background-color: #e0e0e0;
        }

        .br {
            border-right: 1px solid #e0e0e0;
        }

        .bb {
            border-bottom: 1px solid #e0e0e0;
            height: 1px;
        }

        .toRight {
            right: 0;
        }

        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }

        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }

        .swiper-container img {
            width: 100%;
        }
        /* 头部 */

        .nomessage {
            margin-top: 20px;
            font-size: 0.8em;
            text-align: center;
            color: #999;
        }
        /*中间内容*/

        nav {
            height: 70px;
            padding: 8px;
            background-color: #fff;
        }

        .nav-left .nav-img {
            display: inline-block;
            width: 70px;
            height: 70px;
        }

        .nav-left .nav-txt {
            display: inline-block;
            vertical-align: top;
            width: 150px;
            line-height: 35px;
        }

        .nav-right {
            line-height: 65px;
            font-size: 32px;
            color: #666
        }

        ;
        .nav-tit {
            height: 32px;
            padding-left: 8px;
            line-height: 32px;
        }

        .nav-txt>p {
            color: #535354;
        }

        .nav-txt>p: nth-child(2) {
            color: #ccc;
        }

        .sec-tit {
            height: 40px;
            line-height: 40px;
            padding-left: 8px;
        }

        .sec-discuss {
            background-color: #fff;
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sec-img {
            display: inline-block;
            vertical-align: top;
        }

        .sec-img img {
            width: 45px;
            height: 45px;
        }

        .sec-txt {
            display: inline-block;
        }

        .sec-txt>p {
            color: #999;
            line-height: 25px;
        }

        .sec-txt>p:nth-child(2) {
            color: #ccc;
            font-size: 13px;
        }

        .dis-right>span {
            color: #ccc;
            font-size: 12px;
        }

        .dis-right>img {
            width: 18px;
            height: 18px;
            vertical-align: top;
        }

        .dis-txt {
            margin-left: 40px;
            padding-bottom: 10px;
            color: #535354;
        }

        .discuss {
            margin-left: 40px;
            height: auto;
            padding: 10px;
            background-color: #f2f2f3;
            color: #999;
            border-radius: 5px;
        }

        .reply {
            width: 100%;
            height: 20px;
            line-height: 20px;
            text-align: right;
            color: #ccc;
            font-size: 14px;
            padding-right: 10px;
        }
        .collectmusicFxs{width: 25px;}
        .collectmusicFxs img{width: 100%;}
    </style>
</head>

<body>
    <div id="container">
        <nav>
            <div class="nav-left fl">
                <div class="nav-img"><img src="../image/index/downloaddiscover01.jpg" alt=""></div>
                <div class="nav-txt">
                    <p>焚身以火</p>
                    <p>叶倩文</p>
                </div>
            </div>
            <!-- <div class="nav-right fr"> -->
                <!-- <img src="../image/cm2_list_icn_arr.png" alt=""> -->
                <!-- &gt; -->
            <!-- </div> -->
            <div class="clear"></div>
        </nav>
        <section id="section">
            <div class="sec-tit">所有评论</div>
            <div class="sec-discuss" id="comments">
                <!-- <div class="dis-left fl">
                    <div class="sec-img"><img src="../image/icon-person.png" alt=""></div>
                    <div class="sec-txt">
                        <p>燕赵门</p>
                        <p>2017年9月19日</p>
                    </div>
                </div>
                <div class="dis-right fr">
                    <span>3</span><img src="../image/KM_ListingsListDzs.png" alt="" class="zan01">
                </div>
                <div class="clear"></div>
                <div class="dis-txt">海中月是天上月，眼前人是心上人。向来心是看客心，奈何人是剧中人</div>
                <div class="reply" onclick="fnOpenMessageNotDetail()">回复</div>
                <div class="discuss">
                    <span>评论：不知道为什么分开，很多喜欢以为永远会喜欢，到最后才发现任何事情都抵不过时过境迁。</span>
                </div> -->
            </div>
        </section>
    </div>
    <!-- <div class="nomessage">暂无消息02</div> -->
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
    function goback() {
        api.closeWin({
            name: 'discussNoticeDetailFrame0'
        });
    }
    var token;
    var soundId;
    var uris;
    // var name;
    var commentaAlbumGoodHtml;
    var commentExtraGoods;
    apiready = function() {
      token = $api.getStorage('token');
        soundId = api.pageParam.soundId;
        uris = api.pageParam.uris;
        // name = api.pageParam.name;
        ListenToTheListOfComments();
        fnDetails(soundId);
        api.addEventListener({
            name: 'gengXinSingle'
        }, function(ret, err) {

            ListenToTheListOfComments();
        });

        api.setCustomRefreshHeaderInfo({
            bgColor: '#f0f0f0',
            image: {
              pull: [
                  'widget://image/Refresh/dropdown_anim_00.png',
                  'widget://image/Refresh/dropdown_anim_01.png',
                  'widget://image/Refresh/dropdown_anim_02.png',
                  'widget://image/Refresh/dropdown_anim_03.png',
                  'widget://image/Refresh/dropdown_anim_04.png',
                  'widget://image/Refresh/dropdown_anim_05.png',
                  'widget://image/Refresh/dropdown_anim_06.png',
                  'widget://image/Refresh/dropdown_anim_07.png',
                  'widget://image/Refresh/dropdown_anim_08.png',
                  'widget://image/Refresh/dropdown_anim_09.png',
                  'widget://image/Refresh/dropdown_anim_10.png',
            ],
            load: [
              'widget://image/Refresh/dropdown_loading_00.png',
              'widget://image/Refresh/dropdown_loading_01.png',
              'widget://image/Refresh/dropdown_loading_02.png'
          ]}
        }, function() {
                //下拉刷新被触发，自动进入加载状态，使用 api.refreshHeaderLoadDone() 手动结束加载中状态
                //下拉刷新被触发，使用 api.refreshHeaderLoadDone() 结束加载中状态

                      ListenToTheListOfComments();
            });

    }
    function fnDetails(soundId){
      
    }
    function ListenToTheListOfComments(){
      soundId = api.pageParam.soundId;
      uris = api.pageParam.uris;
        api.ajax({
            url: host + apiUri + uris + soundId,
            method: 'get',
            dataType: 'json',
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            }
        }, function(ret, err) {
            if (ret.status == 200) {
              setTimeout(function(){
                  api.refreshHeaderLoadDone()
              },3000)
                var stylelist = $api.byId('comments');
                var html = '';
                for (var i = 0; i < ret.data.length; i++) {
                    var date = new Date(ret.data[i].create_date * 1000); //时间戳为10位需*1000，时间戳为13位的话不需乘1000
                    Y = date.getFullYear() + '年';
                    M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '月';
                    D = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate()) + '日';
                    // h = date.getHours() + ':';
                    // m = date.getMinutes() + ':';
                    // s = date.getSeconds();
                    // return Y+M+D+h+m+s;
                    var dates = Y + M + D;
                    if (ret.data[i].re_nick_name) {
                        html += '<div class="dis-left fl"><div class="sec-img">';
                        if(ret.data[i].photo){
                          html += '<img src="'+ret.data[i].photo+'" alt="">';
                        }else{
                          html += '<img src="../image/KM_tx.png" alt="">';
                        }
                        html += '</div><div class="sec-txt"><p>' + ret.data[i].nick_name + '</p><p>' + dates +
                            '</p></div></div><div class="dis-right fr"><div class="fr" id="commentExtraGood'+ret.data[i].comment_id+'"  class="collectmusicFxs">';
                            var commentaAlbumss = $api.getStorage('commentaAlbumBook_cExtraGood'+ret.data[i].comment_id+'');
                            if(!commentaAlbumss){
                              html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';

                            }else{
                              if(commentaAlbumss != 'inc'){
                                html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';
                              }else{
                                html += '<img src="../image/KM_play_dianzan_red.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="1">';
                              }
                            }

                        html += '</div><div class="fr"><span id="corner_mark'+ret.data[i].comment_id+'">'+ret.data[i].good_total +'</span></div></div><div class="clear"></div><div class="dis-txt">' + ret.data[
                                i].content + '</div><div class="reply"><div  onclick="fnOpenMessageNotDetail(' + ret.data[i].comment_id + ', \'' + ret.data[i].nick_name + '\')">回复</div></div><div class="discuss"><span>' + ret.data[i].re_nick_name + ':' + ret.data[i].re_content +
                            '</span></div>';
                    } else {
                        html += '<div class="dis-left fl"><div class="sec-img">';
                        if(ret.data[i].photo){
                          html += '<img src="'+ret.data[i].photo+'" alt="">';
                        }else{
                          html += '<img src="../image/KM_tx.png" alt="">';
                        }
                        html += '</div><div class="sec-txt"><p>' + ret.data[i].nick_name + '</p><p>' + dates +
                            '</p></div></div><div class="dis-right fr"><div class="fr" id="commentExtraGood'+ret.data[i].comment_id+'"  class="collectmusicFxs">';
                            var commentaAlbumss = $api.getStorage('commentaAlbumBook_cExtraGood'+ret.data[i].comment_id+'');
                            if(!commentaAlbumss){
                              html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';

                            }else{
                              if(commentaAlbumss != 'inc'){
                                html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';
                              }else{
                                html += '<img src="../image/KM_play_dianzan_red.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="1">';
                              }
                            }
                        html += '</div><div class="fr"><span id="corner_mark'+ret.data[i].comment_id+'">'+ret.data[i].good_total +'</span></div></div><div class="clear"></div><div class="dis-txt">' + ret.data[
                                i].content + '</div><div class="reply"><div  onclick="fnOpenMessageNotDetail(' + ret.data[i].comment_id + ', \'' + ret.data[i].nick_name + '\')">回复</div></div>';
                    }
                }
                $api.html(stylelist, html);
            } else {
              // console.log(111);
                // alert(ret.message);
                // $api.rmStorage('token');
                // api.openWin({
                //     name: 'login',
                //     url: '../login.html',
                //     pageParam: {
                //         name: 'test'
                //     }
                // });
            }
        });
      }
      function collectmusicFx(clicktoolitem) {

          var img_id = clicktoolitem.getAttribute("id");

          var toolbarlist = document.getElementById(img_id);
          var click = toolbarlist.getAttribute("data-click");
          var stylelist = $api.byId('corner_mark'+img_id+'');
          var conner_num = parseInt(stylelist.innerText);
          if (click == 0) {
            // 点开
            toolbarlist.setAttribute("data-click", 1);
            toolbarlist.src = "../image/KM_play_dianzan_red.png";
            uri = '/extra/good';
            api.ajax({
                url: host + apiUri + uri + '/' + img_id,
                method: 'post',
                dataType: 'json',
                headers: {
                    "source": api.systemType,
                    "version": version,
                    "session": token
                },
                data:{
                  values:{
                    "type":'inc',
                    "model":'book_c',
                  },
                },
            }, function(ret, err) {
                if (ret.status == 200) {
                    api.toast({              
                        msg:   '已点赞',
                        duration:  2000,
                        location:   'middle'          
                    });

                    conner_num++;
                    $api.html(stylelist, conner_num);
                    $api.setStorage('commentaAlbumBook_cExtraGood'+img_id+'','inc');
                    // $api.rmStorage('commentaAlbumExtraGood'+img_id+'');
                } else {
                //   api.toast({              
                //       msg:  ret.message,
                //       duration:  2000,
                //       location:   'middle'          
                //   });
                //     $api.rmStorage('token');
                //     api.openWin({
                //         name: 'login',
                //         url: '../login.html',
                //     });
                }
            });
          } else {
            // 关闭
            toolbarlist.setAttribute("data-click", 0);
            toolbarlist.src = "../image/KM_ListingsListDzs.png";
            uri = '/extra/good';
            api.ajax({
                url: host + apiUri+uri+'/'+img_id,
                method: 'post',
                dataType: 'json',
                headers: {
                    "source": api.systemType,
                    "version": version,
                    "session": token
                },
                data:{
                  values:{
                    "type":'dec',
                    "model":'book_c',
                  }
                }
            }, function(ret, err) {
                if (ret.status == 200) {
                    api.toast({              
                        msg:   '已取消点赞',
                        duration:  2000,
                        location:   'middle'          
                    });
                    conner_num--;
                    if(conner_num<0){
                      conner_num = 0;
                    }
                    $api.html(stylelist, conner_num);
                    $api.setStorage('commentaAlbumBook_cExtraGood'+img_id+'','dec');
                } else {
                  // api.toast({              
                  //     msg:  ret.message,
                  //     duration:  2000,
                  //     location:  'middle'          
                  // });
                    // $api.rmStorage('token');
                    // api.openWin({
                    //     name: 'login',
                    //     url: '../login.html',
                    // });
                }
            });
          }
      }
        function fnOpenMessageNotDetail(comment_id,name) {
          console.log(name);
            api.openWin({
                name: 'replyDetailSingle',
                url: './reply_detail_single.html',
                pageParam: {
                    comment_id: comment_id,
                    soundId: soundId,
                    uris: uris,
                    name: name
                },
                bounces: false,
                vScrollBarEnabled: true,
                hScrollBarEnabled: true
            });
        }
</script>

</html>
