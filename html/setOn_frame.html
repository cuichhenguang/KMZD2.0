<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>孔孟之道--关于</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
        body,html{
          background-color: #f2f2f2;
        }
        .fl{float: left;}
        .fr{float: right;}
        .clr{clear: both;}
        .currentVersion{
          width: 100%;
          height: 200px;
          text-align: center;
          /*background: rgba(0,0,0,0.3);*/
        }
        .updatedVersion{
          padding: 5px 10px;
          height: 40px;
          line-height: 40px;
          margin: 5px 0;
          /*border-top: 1px solid #ccc;*/
          border-bottom: 1px solid #eee;
          background-color: #fff;
          font-size: 14px;
          color: #000;
        }
        .currentVersion_img{width: 100px;height: 100px;margin: 0 auto;padding: 10px 0;}
        .currentVersion_img img{width: 100%;padding: 15px 0;}
        .right_icon img {
            width: 9px;
            /*height: 23px;*/
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="currentVersion">
      <div class="currentVersion_img"><img src="../image/logo.png" alt=""></div>
      <div class=""  ></div>
    </div>
    <div class="updatedVersion" >
      <div class="fl" >当前版本</div>
      <div class="fr" id="current_version"> </div>
    </div>
    <div class="updatedVersion" id="updatedVersion" onclick="updatedVersion();">
        <div class="fl">检测新版本</div>
        <div class="fr right_icon"><img src="../image/my/index_y.png" alt=""></div>
        <div class="clr"></div>
    </div>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/swiper.min.js"></script>
<script type="text/javascript">
var token;
    apiready = function() {
      token = $api.getStorage('token');
      var stylelist = $api.byId('current_version');
      $api.html(stylelist, version);
    }
    function fnCurrentVersion(){

    }
    function updatedVersion() {
      uri = '/system/latest_version';
      api.ajax({
          url: host + apiUri + uri,
          method: 'get',
          dataType: 'json',
          headers: {
              "source": api.systemType,
              "version": version,
              "session": token
          },
      }, function(ret, err) {
          if (ret.status == 200) {
          console.log(ret.data.version_no);
          v1 = ret.data.version_no ;
          v2 = '1.0.1.1';
          versionCompare(v1,v2);
          } else {

          }
      });

      // api.toast({
      //     msg: '当前版本最新',
      //     duration: 2000,
      //     location: 'middle'
      // });
    }

    function versionCompare(v1,v2){
    //去掉收尾空格
    v1 =v1.replace(/(^\s+)|(\s+$)/gi,"");
    v2 = v2.replace(/(^\s+)|(\s+$)/gi,"");
    //空检查

    if(!v1 || !v2){
        return;
    }
    // console.log(v1);
    // console.log(v2);
    //截取v1,v2中的版本数字
    v1 = /\d(\.|\d)*\d/gi.exec(v1)[0];
    v2 = /\d(\.|\d)*\d/gi.exec(v2)[0];
    // console.log(v1);
    // console.log(v2);
    //版本比较，我们分为三个数组然后比较
    var arr1 = v1.split('.');
    console.log(arr1);
    // arr1 = arr1.map(function(item){
    //     parseInt(item);
    // });
    var arr2 = v2.split('.');
      console.log(arr2);
    // arr2 = arr2.map(function(item){
    //     parseInt(item);
    // });

// console.log(arr1[0]);
// console.log(arr2[0]);
    if(arr1[0]>arr2[0]){
      console.log('更新版本1');
        return true;
    }else if(arr1[0] == arr2[0]){
      console.log(arr1[0]);
      console.log(arr2[0]);
        if(arr1[1]>arr2[1]){
          console.log('更新版本2');
            return true;
        }else if(arr1[1] == arr2[1]){
            if(arr1[2]>arr2[2]){
                console.log('更新版本3');
                return true;
            }else if(arr1[2] == arr2[2]){
                if(arr1[3] > arr2[3]){
                  console.log('更新版本4');
                  return true;
                }else if(arr1[3] == arr2[3]){
                  console.log('已是更新版本');
                  return false;
                }

            }
        }
    }
    console.log('已是更新版本');
    return false;
}
</script>
