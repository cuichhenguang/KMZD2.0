<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>孔孟之道--播放列表</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
	<style>
		html,body{
			height: 100%; background-color: transparent;
			overflow: hidden;
		}
		#mask{height: 25%;}
		#radio-list{
			-webkit-transition: all .3s;
			transition: all .3s;
			-webkit-transform: translateY(100%);
			height: 75%;
			display: -webkit-box;
			display: -webkit-flex;
			display: flex;
			-webkit-box-orient: vertical;
			-webkit-flex-flow: column;
			flex-flow: column;
		}
		#radio-list.in{
			-webkit-transform: translateY(0%);
		}
		#radio-list h2{
			color: #272930;
			font-size: 16px; padding: 14px; background-color: #eaeaea;
		}
		#radio-list ul{
			background-color: #eee;
			position: absolute; width: 100%;
		}
		#radio-list .list{
			position: relative; overflow: auto;
			/*-webkit-overflow-scrolling: touch;*/
			-webkit-box-flex: 1;
			-webkit-flex: 1;
			flex: 1;
		}
		#radio-list li{
			overflow: hidden; padding: 10px 10px 0;
			background: url(../image/ic_arrow_general.png) no-repeat 96% center;
			-webkit-background-size: 18px;
			background-size: 18px;
		}
		#radio-list li.focus{
			background-color: #bebebe;
		}
		#radio-list li.focus p{
			color: #e13430;
		}
		#radio-list li.active p{
			background: url(../image/scheduleliving.png) no-repeat left center;
			padding-left: 10px; color: #e13430;
			-webkit-background-size: 10px 13px;
			background-size: 10px 13px;
		}
		#radio-list li p{
			margin-bottom: 6px;
		}
		#radio-list li div{
			font-size: 16px; color: #272930;
			border-bottom: 1px solid #ddd;
		}
		#radio-list li label{
			margin-bottom: 10px; font-size: 12px; color: #787878;
		}
		#radio-list li .arr{
			float: right; width: 10%;
		}
	</style>
</head>
<body>
<div id="mask"></div>
<div id="radio-list">
	<h2>节目单</h2>
	<div class="list">
		<ul id="history">
			<!-- <li class="active" tapmode="focus">
				<div>
					<p>【美食地图】天南地北一张饼</p>
					<label>时长: 24分10秒</label>
				</div>
			</li> -->
		</ul>
	</div>
</div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
    apiready = function(){
    	var list = $api.byId('radio-list');
      $api.addCls(list, 'in');
      var bodyW = document.getElementsByTagName("body")[0];
      bodyW.onclick=function(evt){
        if(!list[0]){
          $api.removeCls(list, 'in');
      			setTimeout(function(){
      				api.closeFrame();
      			},350);
      		}
      }
      var history = $api.byId('history');
      InitHistory();


    };
    function InitHistory() {
        var history = $api.byId('history');
        api.getPrefs({
            key: 'sousuohistory'
        }, function (ret, err) {

            var historyText = '' || ret.value  ;
            var historyArray = historyText.split(',');
            for (var i = 0; i < historyArray.length; i++) {
                if (historyArray[i].length == 0)
                    continue;
                    //alert(JSON.stringify(historyArray[i]));
                    //var slideArray = { abc:  historyArray };
                    // var slideArray = { abc: historyArray};
                    // console.log(JSON.stringify(slideArray));
                    //console.log(JSON.stringify(slideArray.abc));
                    api.ajax({
                      url: 'http://47.100.11.38/kongmeng/thirdParty/search_songs_by_id.php?id= ' + historyArray[i],
                      method: 'get',
                      dataType: 'json',
                    }, function(ret, err) {
                      if (ret) {
                        //console.log(JSON.stringify(ret));
                        // for (var s = 0; s < ret.length; s++) {
                        //   var historyText = '' || [s]' + : + ' ' + ret[s].data[0].name + ';
                        //   var historyArray = historyText.split(',');
                        // }
                        // // //var slideArray = { abc: historyArray[i].ret};
                        // console.log(JSON.stringify(historyArray));
                        // var abc = new Array();
                        // abc.push(ret);
                         //console.log(JSON.stringify(ret));
                        // for (var i = 0; i < ret.data[0].name.length; i++) {
                        //
                        // //console.log(JSON.stringify(ret.data[0].name.length));
                        //
                        var name = ret.data[0].name;
                        var playtime = ret.data[0].play_time;
                        //shuzu.push(ret.data[0].name);
                        //shuzu.concat(shuzu);
                        // var historyTexts = '' || ret.data[0].name;
                        // var historyArrays = historyTexts.split(',');
                        // for (var i = 0; i < historyArrays.length; i++) {
                        //     decodeURIComponent(historyArrays[i]) == ret.data[0].name && (flag = true);
                        // }
                        // !flag && historyArrays.splice(1,0,encodeURIComponent(ret.data[0].name));
                        // !flag && api.setPrefs({
                        //     key: 'namehistorys',
                        //     value: historyArrays.join(',')
                        // });
                        // console.log(JSON.stringify(historyArrays));
                        //shuzu.concat(ret.data[0].name);
                        fnTitlexianshi(name,playtime);
                        // var shuzus;
                        // for (var r = 0; r < historyArray.length; r++) {
                        //    shuzus = new Array();
                        //    shuzus.push(shuzu);
                        // }
                        // console.log(JSON.stringify(shuzu));
                        // console.log(JSON.stringify(shuzus));
                        // var stylelist = $api.byId('history');
                        // var html = '';
                        // for (var s = 0; s < historyArray.length; s++) {
                        //     html += '<li class="active" tapmode="focus" id="historyArray' + historyArray[i] + '" data-index="' + historyArray[i] + '">' + s + '<div><p>' + ret.data[0].name + '</p><label>时长: ' + ret.data[0].play_time + '</label></div></li>';
                        // }
                        // $api.html(stylelist, html);
                        // history.appendHTML(html);
                        // }
                      } else {
                        alert(JSON.stringify(err));
                      }

                    });
                //fnTitlexianshi(historyArray[i]);
            }
        });
    }
    function fnTitlexianshi(name,playtime){
      api.getPrefs({
          key: 'namehistorys'
      }, function (ret, err) {
          var flag = false;//是否增加历史记录
          var historyText = '' || ret.value ;
          var historyArray = historyText.split(',');
          for (var i = 0; i < historyArray.length; i++) {
              historyArray[i] == name && (flag = true);
          }
          !flag && historyArray.splice(1,0,name);
          !flag && api.setPrefs({
              key: 'namehistorys',
              value: historyArray.join(',')
          });
      });
      api.getPrefs({
          key: 'playtimehistorys'
      }, function (ret, err) {
          var flag = false;//是否增加历史记录
          var historyText = '' || ret.value ;
          var historyArray = historyText.split(',');
          for (var i = 0; i < historyArray.length; i++) {
              historyArray[i] == playtime && (flag = true);
          }
          !flag && historyArray.splice(1,0,playtime);
          !flag && api.setPrefs({
              key: 'playtimehistorys',
              value: historyArray.join(',')
          });
      });
      fnTitlexianshiss();
    }
    function fnTitlexianshiss(){
      var history = $api.byId('history');
      api.getPrefs({
          key: 'namehistorys'
      }, function (ret, err) {
          var historyText = '' || ret.value  ;
          var historyArray = historyText.split(',');
          for (var i = 0; i < historyArray.length; i++) {
              if (historyArray[i].length == 0)
                  continue;
              var stylelist = $api.byId('history');
              var html = '';
              for (var s = 1; s < historyArray.length; s++) {
                console.log(JSON.stringify(historyArray[s]));
                  html += '<li class="active" tapmode="focus" id="historyArray' + historyArray[s] + '" data-index="' + historyArray[s] + '"><div><p>' + historyArray[s] + '</p><label>时长: ' +  + '</label></div></li>';
              }
              $api.html(stylelist, html);
              //history.appendHTML(html);

          }
      });
    }
    // function fnTitlexianshiss(){
    //   var history = $api.byId('history');
    //   api.getPrefs({
    //       key: 'namehistorys'
    //   }, function (ret, err) {
    //       var historyText = '' || ret.value  ;
    //       var historyArray = historyText.split(',');
    //       var historyArrayname;
    //       for (var i = 0; i < historyArray.length; i++) {
    //           if (historyArray[i].length == 0)
    //               continue;
    //           var stylelist = $api.byId('history');
    //           var html = '';
    //           for (var s = 1; s < historyArray.length; s++) {
    //             historyArrayname = historyArray[s];
    //             // console.log(JSON.stringify(historyArray[s]));
    //               // html += '<li class="active" tapmode="focus" id="historyArray' + historyArray[s] + '" data-index="' + historyArray[s] + '"><div><p>' + historyArray[z] + '</p><label>时长: ' + historyArrayplaytime[z] + '</label></div></li>';
    //           }
    //           $api.html(stylelist, html);
    //
    //       }
    //       api.getPrefs({
    //           key: 'playtimehistorys'
    //       }, function (ret, err) {
    //           var historyTextplaytime = '' || ret.value  ;
    //           var historyArrayplaytime = historyTextplaytime.split(',');
    //           for (var i = 0; i < historyArrayplaytime.length; i++) {
    //               if (historyArrayplaytime[i].length == 0)
    //                   continue;
    //               var stylelist = $api.byId('history');
    //               var html = '';
    //               for (var z = 1; z < historyArrayplaytime.length; z++) {
    //                 // console.log(JSON.stringify(historyArray[s]));
    //                   html += '<li class="active" tapmode="focus" id="historyArray' + historyArrayplaytime[z] + '" data-index="' + historyArrayplaytime[z] + '"><div><p>' + historyArrayname + '</p><label>时长: ' + historyArrayplaytime[z] + '</label></div></li>';
    //               }
    //               $api.html(stylelist, html);
    //           }
    //       });
    //   });
    // }
</script>
</html>
