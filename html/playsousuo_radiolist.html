<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>孔孟之道--播放列表</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
	<style>
		html,body{
			height: 100%; background-color: transparent;
			overflow: hidden;
		}
		#mask{height: 25%;}
		#radio-list{
			-webkit-transition: all .3s;
			transition: all .3s;
			-webkit-transform: translateY(100%);
			height: 75%;
			display: -webkit-box;
			display: -webkit-flex;
			display: flex;
			-webkit-box-orient: vertical;
			-webkit-flex-flow: column;
			flex-flow: column;
		}
		#radio-list.in{
			-webkit-transform: translateY(0%);
		}
		#radio-list h2{
			color: #272930;
			font-size: 16px; padding: 14px; background-color: #eaeaea;
		}
		#radio-list ul{
			background-color: #eee;
			position: absolute; width: 100%;
		}
		#radio-list .list{
			position: relative; overflow: auto;
			/*-webkit-overflow-scrolling: touch;*/
			-webkit-box-flex: 1;
			-webkit-flex: 1;
			flex: 1;
		}
		#radio-list li{
			overflow: hidden; padding: 10px 10px 0;
			background: url(../image/ic_arrow_general.png) no-repeat 96% center;
			-webkit-background-size: 18px;
			background-size: 18px;
		}
		#radio-list li.focus{
			background-color: #bebebe;
		}
		#radio-list li.focus p{
			color: #e13430;
		}
		#radio-list li.active p{
			background: url(../image/scheduleliving.png) no-repeat left center;
			padding-left: 10px; color: #e13430;
			-webkit-background-size: 10px 13px;
			background-size: 10px 13px;
		}
		#radio-list li p{
			margin-bottom: 6px;
		}
		#radio-list li div{
			font-size: 16px; color: #272930;
			border-bottom: 1px solid #ddd;
		}
		#radio-list li label{
			margin-bottom: 10px; font-size: 12px; color: #787878;
		}
		#radio-list li .arr{
			float: right; width: 10%;
		}
	</style>
</head>
<body>
<div id="mask"></div>
<div id="radio-list">
	<h2>节目单</h2>
	<div class="list">
		<ul id="history">
			<!-- <li class="active" tapmode="focus">
				<div>
					<p>【美食地图】天南地北一张饼</p>
					<label>时长: 24分10秒</label>
				</div>
			</li> -->
		</ul>
	</div>
</div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
    apiready = function(){
    	var list = $api.byId('radio-list');
      $api.addCls(list, 'in');
      var bodyW = document.getElementsByTagName("body")[0];
      bodyW.onclick=function(evt){
        if(!list[0]){
          $api.removeCls(list, 'in');
      			setTimeout(function(){
      				api.closeFrame();
      			},350);
      		}
      }
      var history = $api.byId('history');
      InitHistory();


    };
    function InitHistory() {
        var history = $api.byId('history');
        api.getPrefs({
            key: 'sousuohistory'
        }, function (ret, err) {

            var historyText = '' || ret.value  ;
            var historyArray = historyText.split(',');

            //var li = '<li class="history " id="historysss{index}" data-index="{index}">{text}<img class="historyImg" src="../image/x.png" alt="" style="float: right;" onclick="ClearHistory({index})" ></li>';
            //console.log(JSON.stringify(historyArray.length));
            for (var i = 0; i < historyArray.length; i++) {
              var stylelist = $api.byId('history');
              var html = '';
                if (historyArray[i].length == 0)
                    continue;
                    //alert(JSON.stringify(historyArray[i]));
                    //var slideArray = { abc:  historyArray };
                    // var slideArray = { abc: historyArray};
                    // console.log(JSON.stringify(slideArray));
                    //console.log(JSON.stringify(slideArray.abc));

                    api.ajax({
                      url: 'http://47.100.11.38/kongmeng/thirdParty/search_songs_by_id.php?id= ' + historyArray[i],
                      method: 'get',
                      dataType: 'json',
                    }, function(ret, err) {
                      if (ret) {
                        for (var s = 0; s < ret.length; s++) {
                          var historyText = '' || [s]' + : + ' ' + ret[s].data[0].name + ';
                          var historyArray = historyText.split(',');
                        }
                        // //var slideArray = { abc: historyArray[i].ret};
                        console.log(JSON.stringify(historyArray));
                        // var abc = new Array();
                        // abc.puch(ret);
                         //console.log(JSON.stringify(ret));
                        // for (var i = 0; i < ret.data[0].name.length; i++) {
                        //
                        // //console.log(JSON.stringify(ret.data[0].name.length));
                        //


                            html += '<li class="active" tapmode="focus" id="historyArray' + i + '" data-index="' + i + '"><div><p>' + ret.data[0].name + '</p><label>时长: ' + ret.data[0].play_time + '</label></div></li>';
                        // }
                      } else {
                        alert(JSON.stringify(err));
                      }

                    });
                //fnTitlexianshi(historyArray[i]);

                // var tempLi = li.replace(/\{index\}/g, i);
                // tempLi = tempLi.replace(/\{text\}/g, decodeURIComponent(historyArray[i]));
                // history.appendHTML(tempLi);

                $api.html(stylelist, html);
                history.appendHTML(html);
            }
        });
    }
    function fnTitlexianshi(datas_){
      // api.removePrefs({
      //     key: 'sousuohistory'
      // });
       //console.log(JSON.stringify(datas_));
       var history = $api.byId('history');
       //console.log(JSON.stringify(datas_.length));
      //  for (var i = 0; i < data_.length; i++) {
      //      var slideArray = { abc: ["' + i + '" = ' + data_[i] + '] };
      //  }

         //console.log(JSON.stringify(data_[i].data_));
          // api.ajax({
          //   url: 'http://47.100.11.38/kongmeng/thirdParty/search_songs_by_id.php?id= ' + datas_,
          //   method: 'get',
          //   dataType: 'json',
          // }, function(ret, err) {
          //   if (ret) {
          //
          //     // var abc = new Array();
          //     // abc.puch(ret);
          //      console.log(JSON.stringify(slideArray));
          //     for (var i = 0; i < ret.data[0].name.length; i++) {
          //
          //     //console.log(JSON.stringify(ret.data[0].name.length));
          //
          //     var stylelist = $api.byId('history');
          //     var html = '';
          //     html += '<li class="active" tapmode="focus" id="historyArray' + i + '" data-index="' + i + '"><div><p>' + ret.data[0].name + '</p><label>时长: ' + ret.data[0].play_time + '</label></div></li>';
          //     $api.html(stylelist, html);
          //     history.appendHTML(html);
          //     }
          //   } else {
          //     alert(JSON.stringify(err));
          //   }
          //
          // });

    }
</script>
</html>
