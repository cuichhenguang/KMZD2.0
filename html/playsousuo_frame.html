<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>孔孟之道--播放</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <link rel="stylesheet" href="../css/swiper.min.css">
      <style>
        /*#wrap{
          height: 100%;
    			background: url(../image/play/play_bg_tra.jpg) no-repeat;
    			-webkit-background-size: cover;
    			background-size: cover;
    			display: -webkit-box;
    			display: -webkit-flex;
    			display: flex;
    			-webkit-box-orient: vertical;
    			-webkit-flex-flow: column;
    			flex-flow: column;
        }*/
          /*轮播图        */
          .swiper-container{
            width: 100%;
            text-align: center;
            height: 250px;
            line-height: 250px;
          }
          .swiper-container img {
              width: 240px;
              /*margin-top: 50px;*/
          }

          /*nav*/
          nav{
            /*background-color: #fff;*/
          }
          .play-tit{
            font-size: 18px;
            color:#000;
            text-align: center;
            margin:0 10px;
            padding-left: 10px;
            padding-bottom: 10px;
          }
          .play-poster{
            margin-left: 40px;
            margin-right: 40px;
            text-align: center;
          }
          .play-poster>img{
            width: 100%;
            height: auto;
          }
          .play-txt{
            width: 100%;
            height: 320px;
            margin: 0 auto 20px;
            text-align: center;
            overflow: hidden;
          }
          .play-txt>p{
            color: #b2b2b2;
            font-size: 13px;
            text-align: center;
            line-height: 20px;
          }
          .play-txt>p:nth-of-type(4){
            color: #000;
            font-size: 15px;
          }
          .play-list{
            width: 100%;
            height: 320px;
            margin: 0 auto 20px;
            text-align: center;
            overflow: hidden;
          }
          .play-list>p{
            color: #000;
            font-size: 14px;
            text-align: left;
            /*padding-left: 50px;*/
            text-align: center;
            line-height: 25px;
          }
          .select {
            display: -webkit-box;
            display: -webkit-flex;
          }
          .select .item-icon {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            text-align: center;
          }
          .select .item-icon>p{
            font-size: 14px;
            color: #999;
          }
          .play-len{
            padding: 10px;
            text-align: center;
          }
          .play-len input{
            width:75%;
            vertical-align: middle;
          }
          .play-len>span{
            font-size: 14px;
            color:#000;
            line-height: 40px;
            width:10%;
            text-align: center;
          }
          .length{
            display: inline-block;
            width: 75%;
            position: relative;
          }

          /*banner*/
          banner{
            display: flex;
            display: -webkit-flex;
            display: -webkit-box;
            /*background-color: #fff;*/
            padding-left: 8px;
          }
          banner .item-sort{
            flex:1;
            -webkit-flex:1;
            -webkit-box-flex:1;
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
            text-align: center;
            line-height: 108px;
          }
          /*banner .side{
            margin-top: 6px;
          }*/
      </style>
  </head>
  <body>
    <div id="wrap">
      <nav>
        <div class="play-tit" id="title">
          <!-- 周易 下经 解卦 第四十 -->
        </div>
        <div class="swiper-container">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                  <img src="../image/poster.png" alt="">
              </div>
              <div class="swiper-slide">
                  <div class="play-txt">
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                    <p>解：利西南；</p>
                    <p>无所往，其来复吉；</p>
                    <p>有攸往，夙吉。</p>
                  </div>
              </div>
              <div class="swiper-slide">
                  <div class="play-list">
                    <p>1152 周易上经 乾卦第一.mp3</p>
                    <p>1153 周易上经 坤卦第二.mp3</p>
                    <p>1154 周易上经 屯卦第三.mp3</p>
                    <p>1155 周易上经 蒙卦第四.mp3</p>
                    <p>1156 周易上经 需卦第五.mp3</p>
                    <p>1157 周易上经 讼卦第六.mp3</p>
                    <p>1158 周易上经 师卦第七.mp3</p>
                    <p>1159 周易上经 比卦第八.mp3</p>
                    <p>1160 周易上经 小畜卦第九.mp3</p>
                    <p>1161 周易上经 履卦第十.mp3</p>
                    <p>1162 周易上经 泰卦第十一.mp3</p>
                    <p>1163 周易上经 否卦第十二.mp3</p>
                    <p>1164 周易上经 同人卦第十三.mp3</p>
                    <p>1165 周易上经 大有卦第十四.mp3</p>
                    <p>1166 周易上经 谦卦第十五.mp3</p>
                    <p>1167 周易上经 豫卦第十六.mp3</p>
                    <p>1168 周易上经 随卦第十七.mp3</p>
                    <p>1169 周易上经 蛊卦第十八.mp3</p>
                    <p>1170 周易上经 临卦第十九.mp3</p>
                    <p>1171 周易上经 观卦第二十.mp3</p>
                    <p>1172 周易上经 噬嗑卦第二十一.mp3</p>
                    <p>1173 周易上经 贲卦第二十二.mp3</p>
                    <p>1174 周易上经 剥卦第二十三.mp3</p>
                    <p>1175 周易上经 复卦第二十四.mp3</p>
                    <p>1176 周易上经 无妄卦第二十五.mp3</p>
                  </div>
                </div>
            </div>
        </div>
        <div class="select">
          <div class="item-icon">
            <img src="../image/play_list.png" alt=""  onclick="openRadioList()" id="play-list">
            <p>播放列表</p>
          </div>
          <div class="item-icon">
            <img src="../image/play_collect.png" alt="" id="playCollect" onclick="fnOpenPlayCollect();">
            <p>收藏</p>
          </div>
          <div class="item-icon">
            <img src="../image/play_share.png" alt=""  onclick="fnOpenPlayShare();">
            <p>分享</p>
          </div>
          <div class="item-icon">
            <img src="../image/play_discuss.png" alt="" onclick="fnOpenPlayDiscuss();" >
            <p>评论</p>
          </div>

          <!-- <div class="item-icon" id="imgBox">
            <img src="../image/play_list.png" alt=""  >
            <img src="../image/play_list.png" alt="" onclick="fnOpenChangeImg(0);" style="display:inline;" >
            <img src="../image/play_choice.png" alt="" onclick="fnOpenChangeImg(1);"  style="display:none;" >
            <img src="../image/play_list.png" alt="" onclick="fnOpenChangeImg(2);"  style="display:none;" >
          </div> -->
        </div>
        <div class="play-len" >
          <span >1.46</span>
          <!-- <div class="length"> -->
            <!-- <img src="../image/play_len.png" alt=""> -->
          <input type="range" value="0" name="" id="range">
          <!-- <progress max="100" value="0" id="pg"></progress> -->
          <!-- </div> -->
          <span >3.46</span>
        </div>
      </nav>
      <banner>
        <div class="item-sort">
          <img src="../image/play_change0.png" alt="" id="img">
        </div>
        <div class="item-sort">
          <img src="../image/play_prev.png" alt="">
        </div>
        <div class="item-sort" id="openplayer">
          <!-- <img src="../image/play_stop.png" alt="" onclick="fnOpenPlayer()"; id="player"> -->
        </div>
        <div class="item-sort">
          <img src="../image/play_next.png" alt="">
        </div>
        <div class="item-sort side">
          <img src="../image/play_choice.png" alt="" onclick="fnOpenChoicePlayer();">
        </div>
      </banner>
    </div>
    <input type="hidden" id="input" value="">
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript" src="../script/swiper.min.js"></script>
  <script type="text/javascript">

    apiready = function(){
      var id = api.pageParam.a;
      var eHeader = $api.byId('header')
      fnInitSwiper();
      fnOpenChangeImg();

      AddHistory(id);
      fnTitle();
      var bofang = api.pageParam.bofang;
      if (!bofang) {
        //alert(bofang);
        // var stylelist = $api.byId('centerVedeo');
        var stylelist = $api.byId('openplayer');
        var html = '';
        html += '<img src="../image/play_stop.png" alt="" onclick="fnOpenPlayer()"; id="player"></div>';
        $api.html(stylelist, html);
      }else if (bofang == 0){
        var stylelist = $api.byId('openplayer');
        var html = '';
        html += '<img src="../image/play_stop.png" alt="" onclick="fnOpenPlayer()"; id="player"></div>';
        $api.html(stylelist, html);
      }else if(bofang == 1){
        var stylelist = $api.byId('openplayer');
        var html = '';
        html += '<img src="../image/play_now.png" alt="" onclick="fnOpenPlayer()"; id="player"></div>';
        $api.html(stylelist, html);
      }
    };
    //播放
    function fnOpenPlayer(){
      var player = $api.byId('player');
      if(player.getAttribute("src",2)=="../image/play_stop.png"){
        player.src="../image/play_now.png";
        fnNetAudiosPlayByID();
        var bofang = 1;
        var a = api.pageParam.a;

        api.sendEvent({
  				name: 'netbofang',
  				extra: {
  					bofang: bofang,
            a: a
  				}
  			});
      }else{
        player.src="../image/play_stop.png";
        var netAudiopausess = '';
        var bofang = 0;
        //alert(bofang);
        var a = api.pageParam.a;

        api.sendEvent({
  				name: 'netbofang',
  				extra: {
  					bofang: bofang,
            a: a
  				}
  			});
  			api.sendEvent({
  				name: 'netAudiopause',
  				extra: {
  					netAudiopauses: netAudiopausess
  				}
  			});
      }
    }
    function fnNetAudiosPlayByID(){
      var id = api.pageParam.a;
      api.ajax({
				url: 'http://47.100.11.38/kongmeng/thirdParty/search_songs_by_id.php?id= ' + id,
				method: 'get',
				dataType: 'json',
			}, function(ret, err) {
				if (ret) {
					//console.log(JSON.stringify(ret));
					//c = ret.data[0].id;
					netAudioss = ret;
					api.sendEvent({
						name: 'netAudioplay',
						extra: {
							netAudios: netAudioss
						}
					});
				} else {
					alert(JSON.stringify(err));
				}
			});
    }
    function fnTitle(){
      var id = api.pageParam.a;
      api.ajax({
				url: 'http://47.100.11.38/kongmeng/thirdParty/search_songs_by_id.php?id= ' + id,
				method: 'get',
				dataType: 'json',
			}, function(ret, err) {
				if (ret) {
					//console.log(JSON.stringify(ret));
					fnTitlexianshi(ret);
				} else {
					alert(JSON.stringify(err));
				}
			});
    }
    function fnTitlexianshi(ret){
      var stylelist = $api.byId('title');
      var html = ret.data[0].name;
      $api.html(stylelist, html);
    }
    // 轮播
    function fnInitSwiper() {
        var mySwiper = new Swiper('.swiper-container', {
            autoplay: false,
            loop: true,
        });
    };
    // 选择播放器
    function fnOpenChoicePlayer(){
      api.openWin({
          name: 'choicePlayer',
          url: './choice_player.html',
      });
    };
    // 收藏
    function fnOpenPlayCollect(){
      var playCollect = $api.byId('playCollect');
      if(playCollect.getAttribute("src",2)=="../image/play_collect.png"){
        playCollect.src="../image/play_collect0.png";

      }else{
        playCollect.src="../image/play_collect.png";

      }
    };
    // 打开评论页面
    function fnOpenPlayDiscuss(){
      api.openWin({
        name: 'playDiscuss',
        url: './play_discuss.html',
      })
    }
    //打开分享
    function fnOpenPlayShare(){
      var dialogBox = api.require('dialogBox');
      dialogBox.actionMenu ({
          rect:{
              h: 150
          },
          texts:{
               cancel: '取消'
          },
          items:[
          {
              text: '微信',
              icon: 'widget://image/weixin.png'
          },
          {
              text: 'QQ',
              icon: 'widget://image/qq.png'
          },
          {
              text: '朋友圈',
              icon: 'widget://image/friends.png'
          }
          ],
          styles:{
              bg:'#FFF',
              column: 3,
              itemText: {
                  color: '#000',
                  size: 12,
                  marginT:8
              },
              itemIcon:{
                  size:48
              },
              cancel:{
                  bg: 'fs://icon.png',
                  color:'#000',
                  h: 44 ,
                  size: 14
              }
          }
      }, function(ret){
        dialogBox.close({
                  dialogName: 'alert'
        })
      });
    }
    //打开播放列表
    function openRadioList(){
  		var height = api.frameHeight + 50 ;
  		api.openFrame({
  		    name: 'playsousuo_radiolist',
  		    url: './playsousuo_radiolist.html',
  		    bounces: false,
  		    bgColor: 'rgba(0,0,0,0.6)',
  		    rect:{
  		        x: 0,
  		        y: 0,
  		        w: api.frameWidth,
  		        h: height
  		    }
  		});
  	}
    function AddHistory(id) {
          api.getPrefs({
              key: 'sousuohistory'
          }, function(ret, err){
              if( ret ){
                //console.log(JSON.stringify(ret));
                   var flag = false;//是否增加历史记录
                   var historyText = ret.value ;

                    var historyArray = historyText.split(',');
                    //console.log(JSON.stringify(historyArray));
                    for (var i = 0; i < historyArray.length; i++) {
                        historyArray[i] == id && (flag = true);
                    }
                    !flag && historyArray.splice(1,0,id);
                    !flag && api.setPrefs({
                        key: 'sousuohistory',
                        value: historyArray.join(',')
                    });

              }else{
                   alert( JSON.stringify( err ) );
              }
          });


    }
    //滑块
    function slider(){

    }
    // 切换单曲循环、顺序播放、随机播放
    function fnOpenChangeImg(){
      var image_urls = [ "../image/play_change0.png", "../image/play_change1.png", "../image/play_change2.png"];
        // 初始化数组键值 (0 = 第一个图片)
        var idx = 0;
        // 点击 id 为 img 的图片
      document.getElementById("img").onclick = function() {
          // idx + 1，如果为最后一张，还原回第一张
          idx = idx === image_urls.length - 1 ? 0 : idx + 1;
          // 设置 src
          this.src = image_urls[idx];
          // 测试
          // alert(this.src);
      };
      // var imgs = document.getElementById('imgBox').getElementsByTagName('img');
      // for(var i=0;i<=imgs.length;i++){
      //   if(i==num+1){
      //      imgs[i].style.display="inline";
      //   }else{
      //     imgs[i].style.display="none";
      //   };
      //   if(num==2){
      //     imgs[0].style.display="inline";
      //   };
      // }
    };

  </script>
  </html>
