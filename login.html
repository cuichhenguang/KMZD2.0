<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>孔孟之道--登陆</title>
    <link rel="stylesheet" type="text/css" href="./css/api.css" />
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <link rel="stylesheet" href="./css/iconfont/iconfont.css">
    <link rel="stylesheet" href="./css/iconfont.css">
    <style>
        html,
        body {
            /*min-height: 100%;*/
            background-image: url(./image/login/login_bg.png);
            background-size: 100% 100%;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .p20px {
            padding: 0 40px;
        }

        .fl {
            float: left;
        }

        .fr {
            float: right;
        }

        .clr {
            clear: both;
        }

        #footer {
            width: 100%;
            height: 150px;
            position: absolute;
            bottom: 0;
        }

        #footer .login_wx {
            width: 200px;
            height: 40px;
            border-radius: 20px;
            background-color: #89211b;
            margin: 0 auto;
            text-align: center;
            line-height: 40px;
            color: #fff;
        }

        .login_footer {
            padding: 20px 0;
        }

        .login_qq,
        .login_sj {
            color: #89211b;
        }
    </style>
</head>

<body>
    <div id="footer">
        <div class="login_wx" onclick="fnWXLogin();">
            微信登录
        </div>
        <div class="login_footer">
            <div class="p20px">
                <div class="login_qq fl" onclick="fnQQLogin();">QQ登录 ></div>
                <div class="login_sj fr" onclick="fnSjWin();">手机号登录 ></div>
                <div class="clr"></div>
            </div>
        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="script/api.js"></script>
<!-- <script type="text/javascript" src="script/index.js"></script> -->
<script type="text/javascript">
    var wx, qq, weibo;
    var userInfos = JSON.stringify($api.getStorage("userInfo"));
    apiready = function() {

    }

    function fnqqDl() {

    }

    function fntuichuWBLogin() {
        var weiXin = api.require('weiXin');
        weiXin.cancelAuth(function(ret, err) {
            if (ret.status) {
                api.alert({
                    msg: '退出成功'
                });
            } else {
                api.alert({
                    msg: err.msg
                });
            }
        });
    }

    function fnSjWin() {
        api.openWin({
            name: 'login_user',
            url: 'login_user.html',
            pageParam: {
                name: 'test'
            }
        });

    }
    var accessToken;
    var openId;

    function fnWXLogin() {
      var wx = api.require('wx');
      wx.auth({
        apiKey: ''
      }, function(ret, err) {
        if (ret.status) {
            // alert(JSON.stringify(ret));
            // console.log(JSON.stringify(ret));
            api.openWin({
                name: 'index',
                url: './index.html',
                pageParam: {
                    name: 'test',
                }
            });
        } else {
            alert(err.code);
        }
      });
        // wx = api.require('weiXin');
        // var code;
        // wx.registerApp(function(ret, err) {
        //     // console.log('111');
        //     //api.alert({ msg: '' + ret.status });
        //     if (ret.status) {
        //         //alert(JSON.stringify(ret.status));
        //         // console.log('222');
        //
        //         // weiXin.refreshToken(function(ret, err) {
        //         //     if (ret.status) {
        //         //         api.alert({ msg: '刷新成功' });
        //         //     } else {
        //         //         api.alert({ msg: err.msg });
        //         //     }
        //         // });
        //         wx.auth(function(ret, err) {
        //           // console.log('333');
        //             //console.log(JSON.stringify(ret));
        //             //api.alert({ msg: ret.status });
        //             //api.alert({ msg: ret.token });
        //             if (ret.status) {
        //                 // alert(JSON.stringify(ret.status));
        //                 //alert(JSON.stringify(ret.code));
        //
        //                 wx.getUserInfo(function(ret, err) {
        //                     var wxjibenziliao = ret;
        //                     if (ret.status) {
        //                         //alert('222');
        //                         console.log(JSON.stringify(ret));
        //                         api.openWin({
        //                             name: 'index',
        //                             url: './index.html',
        //                             pageParam: {
        //                                 name: 'test',
        //                                 wxjibenziliao: wxjibenziliao
        //                             }
        //                         });
        //
        //                         var data = {
        //                             values: {
        //                                 openid: ret.openid,
        //                                 nickname: ret.nickname,
        //                                 sex: ret.sex,
        //                                 headimgurl: ret.headimgurl,
        //                                 province: ret.province,
        //                                 city: ret.city,
        //                                 privilege: ret.privilege,
        //                                 country: ret.country,
        //                                 unionid: ret.unionid,
        //                             }
        //                         };
        //                         $api.setStorage("userInfo", data);
        //                         // console.log(JSON.stringify($api.getStorage("userInfo")));
        //
        //                         //alert(JSON.stringify(ret));
        //                         //alert(JSON.stringify(nickname));
        //                     } else {
        //                         api.alert({
        //                             msg: err.msg
        //                         });
        //                         //alert(err.code);
        //                     }
        //                 });
        //             } else {
        //                 api.alert({
        //                     msg: err.msg
        //                 });
        //                 //alert(err.code);
        //             }
        //         });
        //     } else {
        //         api.alert({
        //             msg: err.msg
        //         });
        //         alert('当前设备未安装微信客户端');
        //     }
        // });
    }

    function fnQQLogin() {
        qq = api.require('qq');
        var login = function() {
            qq.login(function(ret, err) {
                var openId = ret.openId;
                var accessToken = ret.accessToken;
                console.log(JSON.stringify(ret));
                if (ret.status) {

                    api.alert({
                        title: '授权成功',
                        msg: '正在打开孔孟知道...',
                    }, function(ret, err) {
                        console.log(JSON.stringify(ret));
                        // alert(api.accessToken);
                        if (ret) {
                            // alert( JSON.stringify( ret ) );

                            qq.getUserInfo(function(ret, err) {
                                if (ret.status) {
                                    // console.log(JSON.stringify(ret.info));
                                    //alert(JSON.stringify(ret));
                                    var qqziliao = ret.info;
                                    api.openWin({
                                        name: 'index',
                                        url: './index.html',
                                        pageParam: {
                                            name: 'test',
                                            qqziliao: qqziliao
                                        }
                                    });
                                } else {
                                    alert(JSON.stringify(err));
                                }
                            });
                        } else {
                            alert(JSON.stringify(err));
                        }
                    });
                } else {
                    //var toast = new auiToast();
                    // var toast.fail({
                    //     title: "授权失败",
                    //     duration: 1500
                    // });
                }
            });
        };
        qq.installed(function(ret, err) {
            if (ret.status) {
                login();
            } else {
                api.alert({
                    msg: "当前设备未安装QQ客户端"
                });
            }
        });
    };
</script>
